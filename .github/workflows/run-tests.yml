---
    name: "Run Tests"
    
    on:
      workflow_dispatch:
      pull_request:
        types: [opened, edited, synchronize, reopened]
        branches:
          - main
          - dev
        paths:
          - "app/**"
          - "tests/**"
    
    jobs:
      tests:
        runs-on: ubuntu-latest
        timeout-minutes: 10
        environment: ${{ github.ref == 'refs/heads/main' }}
        steps:
          - name: Checkout
            uses: actions/checkout@v4
    
          - name: Setup Python
            uses: actions/setup-python@v4
            with:
              python-version: "3.11"

          - name: Cache the virtualenv
            uses: actions/cache@v2
            with:
              path: ./.venv
              key: ${{ runner.os }}-venv-${{ hashFiles('**/poetry.lock') }}
    
          - name: Install dependencies
            run: |
                python install -r requirements.txt

          - name: Run tests
            run: |
              python -m pytest tests

    